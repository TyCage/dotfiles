colorscheme solarized-dark

set defsearch=g
set editor="urxvt -name vimp-ext-editor -e vim"
set guioptions=brs

" Remove all key mappings (1.0b7pre+) as mapclear in Vimperator and older
" versions.
unmap!

map , <Leader>

" guioptions!=s controls and options.showtabline control all windows, not what
" I need. I need to control each individually.
map <silent> <C-F8> :js toggle_toolbar('addon-bar');<CR>
map <silent> <S-F8> :js toggle_toolbar('TabsToolbar');<CR>
map <silent>   <F8> :js toggle_toolbars(['PersonalToolbar', 'nav-bar', 'toolbar-menubar']);<CR>

" Tab order rearragement
map <silent> <C-S-PageUp> :tabm -1<CR>
map <silent> <C-S-PageDown> :tabm +1<CR>

" Enable to copy original URL
map Y :yank gBrowser.contentDocument.location.href<CR>

" I hate when I want to press <C-w> but I hit q instead
map <C-q> <Nop>

" Toggle app tab
map <C-A-a> :pintab!<CR>

" Clean up all auto commands
autocmd!

js <<EOF
window.toggle_toolbar = function(id) {
  var tb = document.getElementById(id);
  if (tb._visible === undefined)
    tb._visible = id == 'addon-bar' || id == 'TabsToolbar';
  tb._visible = !tb._visible;
  window.setToolbarVisibility(tb, tb._visible);
  }

window.toggle_toolbars = function(ids) {
  for (var i in ids)
    window.toggle_toolbar(ids[i]);
  }

window.one_unpinned_tab = function(event) {
  for (var idx = 0; idx < gBrowser.tabs.length; idx++) {
    var tab = gBrowser.tabs[idx];
    if (!tab.pinned && !tab.closing) {
      return;
      }
    }
  gBrowser.addTab('about:blank');
  }
gBrowser.mTabContainer.addEventListener('TabClose', one_unpinned_tab, false);
gBrowser.mTabContainer.addEventListener('TabPinned', one_unpinned_tab, false);

window.change_tab_bg = function(id, color) {
  var tab = tabs.getTab(id);

  if (!tab)
    return;

  tab.linkedBrowser.contentDocument.body.style.backgroundColor = color;
}
EOF

:if config.profileName == "Normal"
  " Enter passthrough mode automatically in Gmail, CommaFeed
  au LocationChange (mail|groups)\.google\.com normal! <C-z>
  au LocationChange www\.commafeed\.com\/ normal! <C-z>

  " Enter Insert mode
  au LocationChange docs\.google\.com :normal gi

  au PageLoad 'about:blank' js change_tab_bg(<tab>-1, "#333");
  " PageLoad isn't fired when browser is launched
  :if getBrowser().contentDocument.location.href == 'about:blank'
    js getBrowser().contentDocument.body.style.backgroundColor = "#333";
  :endif
  " The following line is simple but has problem with Blogger post editor, it
  " causes the background color of editor becomes #333.
  " style -name blank about:blank body { background-color: #333 !important }
:elif config.profileName == "Test"
  au PageLoad 'about:blank' js change_tab_bg(<tab>-1, "#633");
  " PageLoad isn't fired when browser is launched
  :if getBrowser().contentDocument.location.href == 'about:blank'
    js getBrowser().contentDocument.body.style.backgroundColor = "#633";
  :endif
  source '~/.pentadactyl-Test.rc'
:endif


" ====== "
" Styles "
" ====== "

" Delete all styles, first.
delstyle!

" Tired of these shits, CPU suckers
style * <<EOF
* {
  border-radius: 0 !important;

  box-shadow: none !important;
  text-shadow: none !important;

  animation: none !important;
  transition: none !important;
}
EOF

" Google
" ======

" fix gmail doesn't have readable monospace theme, Terminal uses Courier New which is horrible to read.
" fix groups, it is... ahm... never mind.
style mail.google.com,groups.google.com -name google-monospace * { font-family: 'Envy Code R' !important }

" YouTube
" =======

" remove annoying channel trailers
au DOMLoad '^https://www\.youtube\.com/(channel|user)/\w+(/featured){0,1}' :js <doc>.getElementsByClassName('c4-player-container')[0].remove();
